<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Butonlu Sayfa ‚Äî GitHub JSON Kayƒ±tlƒ±</title>
  <style>
    :root{
      --bg:#0b0f17; --card:#0b1220; --accent:#00b894; --muted:#9fb0c8;
      --btn:#142235; --input:#0f1724; --border:#1b2636;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,Roboto,-apple-system,Segoe UI,Arial;
      color:#e6eef8;
      background:linear-gradient(180deg,#051026 0%,var(--bg) 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }
    .container{
      width:100%;
      max-width:720px;
      padding:18px;
      border-radius:18px;
      background:var(--card);
      box-shadow:0 12px 40px rgba(2,6,23,0.6);
    }
    .header{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:14px;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);
      display:flex;align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,0.03);
    }
    .logo strong{color:var(--accent);}
    h1{font-size:18px;margin:0;}
    .lead{font-size:13px;color:var(--muted);margin-top:4px;}
    .buttons{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:12px;
    }
    .btn{
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px;
      border-radius:12px;
      background:var(--btn);
      border:1px solid rgba(255,255,255,0.02);
      cursor:pointer;
      overflow:hidden;
      transition:transform .15s, background .15s;
    }
    .btn:hover{
      background:#162b40;
      transform:translateY(-2px);
    }
    .icon{
      width:48px;
      height:48px;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,0.02);
      flex-shrink:0;
      font-size:20px;
    }
    .label{
      font-weight:700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:60%;
    }
    .sublabel{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:35%;
    }
    .editor{
      margin-top:16px;
      background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(0,0,0,0.02));
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.02);
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    input[type=text], select{
      flex:1;
      min-width:90px;
      padding:8px;
      border-radius:8px;
      border:1px solid var(--border);
      background:var(--input);
      color:#fff;
      font-size:13px;
    }
    button.small{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      background:var(--input);
      color:#fff;
      cursor:pointer;
    }
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
      justify-content:space-between;
      align-items:center;
    }
    .footer{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }
    .row .actions{
      display:flex;
      gap:6px;
      align-items:center;
      margin-left:auto;
      flex-shrink:0;
    }
    .row .actions button{
      padding:6px 8px;
    }
    .row .extra{
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:wrap;
    }
    @media(max-width:480px){
      .label{max-width:50%;}
      .sublabel{max-width:40%;}
      input[type=text],select{min-width:70px;}
    }
    .pill{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(15,23,42,0.7);
      color:var(--muted);
    }
  </style>
</head>
<body>
<div class="container" role="application" aria-label="Butonlu Sayfa">
  <div class="header">
    <div class="logo"><strong>SB</strong></div>
    <div>
      <h1>Butonlu Sayfa</h1>
      <div class="lead">Link / Mail / Dosya ‚Äî GitHub JSON ile kalƒ±cƒ± kayƒ±t.</div>
    </div>
  </div>

  <div class="buttons" id="buttons" aria-live="polite"></div>

  <div class="editor">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <div style="font-weight:700;">Butonlarƒ± D√ºzenle</div>
      <div class="pill">Kaydet: JSON indir ‚Üí GitHub'da butonlar.json olarak y√ºkle</div>
    </div>
    <div id="edit-list"></div>
    <div class="controls">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <button id="addBtn" class="small">Buton Ekle</button>
        <button id="saveJsonBtn" class="small">Kaydet (JSON indir)</button>
        <button id="importBtn" class="small">ƒ∞√ße Aktar</button>
        <button id="resetBtn" class="small">Sƒ±fƒ±rla (Yerel)</button>
      </div>
      <div style="font-size:12px;color:var(--muted);">
        A√ßƒ±lƒ±≈üta: butonlar.json (GitHub) ‚Üí <strong>Y√ºklenir</strong>
      </div>
    </div>
  </div>

  <div class="footer">Bu sayfayƒ± GitHub Pages √ºzerinde barƒ±ndƒ±r, k√∂kte butonlar.json bulunsun.</div>
</div>

<script>
// --------- AYARLAR ---------
const JSON_URL = "butonlar.json"; // aynƒ± repo i√ßinde k√∂kte
const LOCAL_KEY = "butonlu_all_in_one_with_json_v1";

// Dosyalar sadece cihazda tutulacak (JSON'a yazƒ±lmayacak)
let fileData = {}; // { id: { name, dataUrl } }

const DEFAULTS = [
  { id: 1, label: "Instagram", url: "https://www.instagram.com/sebukagraphic_", icon: "üì∑", type: "link" },
  { id: 2, label: "E-posta", mail: "serhatbrkkrg@gmail.com", icon: "‚úâÔ∏è", type: "mail" }
];

function escapeHtml(s){ if(!s) return ""; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function escapeAttr(s){ if(!s) return ""; return String(s).replace(/"/g,'&quot;'); }

// --------- JSON Y√úKLEME (GitHub) + Yerel cache fallback ---------
async function loadButtonsFromJson(){
  // √ñnce localStorage'a bak (cache gibi)
  try{
    const cached = localStorage.getItem(LOCAL_KEY);
    if(cached){
      const parsed = JSON.parse(cached);
      if(Array.isArray(parsed) && parsed.length) return parsed;
    }
  }catch(e){ console.warn("localStorage okunamadƒ±", e); }

  // Sonra butonlar.json'u √ßek
  try{
    const res = await fetch(JSON_URL, {cache:"no-store"});
    if(!res.ok) throw new Error("butonlar.json bulunamadƒ±: " + res.status);
    const data = await res.json();
    if(Array.isArray(data)){
      localStorage.setItem(LOCAL_KEY, JSON.stringify(data));
      return data;
    }
  }catch(e){
    console.warn("JSON y√ºklenemedi, DEFAULTS kullanƒ±lacak", e);
  }
  localStorage.setItem(LOCAL_KEY, JSON.stringify(DEFAULTS));
  return DEFAULTS.slice();
}

function saveButtonsLocally(list){
  localStorage.setItem(LOCAL_KEY, JSON.stringify(list));
  localStorage.setItem(LOCAL_KEY+"_files", JSON.stringify(fileData));
}

function loadFileData(){
  try{
    const raw = localStorage.getItem(LOCAL_KEY+"_files");
    if(!raw) return;
    const parsed = JSON.parse(raw);
    if(parsed && typeof parsed === "object") fileData = parsed;
  }catch(e){
    console.warn("fileData okunamadƒ±", e);
  }
}

// --------- RENDER BUTONLAR ---------
function renderButtons(list){
  const c = document.getElementById("buttons");
  c.innerHTML = "";
  list.forEach(it=>{
    const b = document.createElement("div");
    b.className = "btn";
    b.tabIndex = 0;
    const icon = escapeHtml(it.icon || "üîó");
    const label = escapeHtml(it.label || "");
    let sub = "";
    if(it.type === "mail") sub = escapeHtml(it.mail || "E-posta");
    else if(it.type === "dosya") sub = fileData[it.id]?.name || "Dosya";
    else sub = escapeHtml(it.url || "");
    b.innerHTML =
      '<div class="icon" aria-hidden="true">'+ icon +'</div>' +
      '<div style="min-width:0;"><div class="label">'+ label +'</div>' +
      '<div class="sublabel">'+ sub +'</div></div>';
    b.addEventListener("click", ()=> openItem(it));
    b.addEventListener("keydown", e=>{ if(e.key === "Enter") openItem(it); });
    c.appendChild(b);
  });
}

function openItem(it){
  if(it.type === "mail"){
    if(!it.mail){ alert("Bu buton i√ßin e-posta adresi yok."); return; }
    window.location.href = "mailto:" + it.mail;
    return;
  }
  if(it.type === "dosya"){
    const f = fileData[it.id];
    if(!f){ alert("Bu butona dosya eklenmemi≈ü."); return; }
    const a = document.createElement("a");
    a.href = f.dataUrl;
    a.download = f.name;
    a.click();
    return;
  }
  if(it.url){
    window.open(it.url, "_blank", "noopener");
    return;
  }
  alert("Bu buton i√ßin i≈ülem tanƒ±mlƒ± deƒüil.");
}

// --------- RENDER EDITOR ---------
function renderEditor(list){
  const el = document.getElementById("edit-list");
  el.innerHTML = "";
  list.forEach((it, idx)=>{
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <input data-i="${idx}" class="lbl" placeholder="Etiket" value="${escapeAttr(it.label||"")}" />
      <input data-i="${idx}" class="url" placeholder="https://..." value="${escapeAttr(it.url||"")}" />
      <select data-i="${idx}" class="typ">
        <option value="link">Link</option>
        <option value="mail">Mail</option>
        <option value="dosya">Dosya</option>
      </select>
      <input data-i="${idx}" class="icn" placeholder="ikon" value="${escapeAttr(it.icon||"üîó")}" style="width:60px" />
      <div class="extra"></div>
      <div class="actions">
        <button data-i="${idx}" class="small up" title="Yukarƒ±">‚ñ≤</button>
        <button data-i="${idx}" class="small down" title="A≈üaƒüƒ±">‚ñº</button>
        <button data-i="${idx}" class="small del" title="Sil">üóë</button>
      </div>`;
    el.appendChild(row);
  });
  el.querySelectorAll(".typ").forEach(sel=>{
    const i = +sel.dataset.i;
    sel.value = list[i].type || "link";
  });
  updateExtras(list);
  attachEditorHandlers(list);
}

function updateExtras(list){
  document.querySelectorAll(".extra").forEach(ex=>{
    ex.innerHTML = "";
    const idx = +ex.parentElement.querySelector(".lbl").dataset.i;
    const it = list[idx];
    if(it.type === "mail"){
      const mailInput = document.createElement("input");
      mailInput.type = "text";
      mailInput.placeholder = "E-posta adresi";
      mailInput.value = it.mail || "";
      mailInput.addEventListener("input", e=>{
        it.mail = e.target.value;
        saveButtonsLocally(list);
        renderButtons(list);
      });
      ex.appendChild(mailInput);
    }else if(it.type === "dosya"){
      const btnFile = document.createElement("button");
      btnFile.className = "small";
      btnFile.textContent = fileData[it.id] ? "Dosya Deƒüi≈ütir" : "Dosya Y√ºkle";
      btnFile.addEventListener("click", ()=>{
        const inp = document.createElement("input");
        inp.type = "file";
        inp.accept = ".pdf,image/*,application/*";
        inp.onchange = e=>{
          const f = e.target.files[0];
          if(!f) return;
          const reader = new FileReader();
          reader.onload = ev=>{
            fileData[it.id] = { name:f.name, dataUrl:ev.target.result };
            saveButtonsLocally(list);
            renderButtons(list);
            updateExtras(list);
            alert("Dosya y√ºklendi: " + f.name);
          };
          reader.readAsDataURL(f);
        };
        inp.click();
      });
      ex.appendChild(btnFile);

      if(fileData[it.id]){
        const info = document.createElement("span");
        info.style.fontSize = "12px";
        info.style.color = "var(--muted)";
        info.textContent = fileData[it.id].name;
        ex.appendChild(info);
      }
    }
  });
}

function attachEditorHandlers(list){
  document.querySelectorAll(".lbl").forEach(inp=>{
    inp.addEventListener("input", e=>{
      const i = +inp.dataset.i;
      list[i].label = e.target.value;
      saveButtonsLocally(list);
      renderButtons(list);
    });
  });
  document.querySelectorAll(".url").forEach(inp=>{
    inp.addEventListener("input", e=>{
      const i = +inp.dataset.i;
      list[i].url = e.target.value;
      saveButtonsLocally(list);
      renderButtons(list);
    });
  });
  document.querySelectorAll(".icn").forEach(inp=>{
    inp.addEventListener("input", e=>{
      const i = +inp.dataset.i;
      list[i].icon = e.target.value;
      saveButtonsLocally(list);
      renderButtons(list);
    });
  });
  document.querySelectorAll(".typ").forEach(sel=>{
    sel.addEventListener("change", e=>{
      const i = +sel.dataset.i;
      list[i].type = e.target.value;
      saveButtonsLocally(list);
      renderEditor(list);
      renderButtons(list);
    });
  });
  document.querySelectorAll(".up").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const i = +btn.dataset.i;
      if(i <= 0) return;
      [list[i-1], list[i]] = [list[i], list[i-1]];
      saveButtonsLocally(list);
      renderEditor(list);
      renderButtons(list);
    });
  });
  document.querySelectorAll(".down").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const i = +btn.dataset.i;
      if(i >= list.length-1) return;
      [list[i], list[i+1]] = [list[i+1], list[i]];
      saveButtonsLocally(list);
      renderEditor(list);
      renderButtons(list);
    });
  });
  document.querySelectorAll(".del").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const i = +btn.dataset.i;
      const id = list[i].id;
      if(!confirm("Bu butonu silmek istiyor musun?")) return;
      list.splice(i,1);
      if(fileData[id]) delete fileData[id];
      saveButtonsLocally(list);
      renderEditor(list);
      renderButtons(list);
    });
  });
}

// --------- JSON ƒ∞NDƒ∞R (GITHUB'A Y√úKLEMEK ƒ∞√áƒ∞N) ---------
function downloadButtonsJson(list){
  const plain = list.map(it=>({
    id: it.id,
    label: it.label || "",
    url: it.url || "",
    type: it.type || "link",
    icon: it.icon || "",
    mail: it.mail || ""
  }));
  const blob = new Blob([JSON.stringify(plain,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "butonlar.json";
  a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 300);
}

// --------- INIT ---------
document.addEventListener("DOMContentLoaded", async ()=>{
  loadFileData();
  let buttons = await loadButtonsFromJson();
  // id garantile
  buttons = buttons.map(b=>{
    if(!b.id) b.id = Date.now() + Math.floor(Math.random()*10000);
    if(!b.type) b.type = "link";
    return b;
  });
  saveButtonsLocally(buttons);

  renderButtons(buttons);
  renderEditor(buttons);

  document.getElementById("addBtn").addEventListener("click", ()=>{
    buttons.push({
      id: Date.now(),
      label: "Yeni Buton",
      url: "",
      icon: "üîó",
      type: "link",
      mail: ""
    });
    saveButtonsLocally(buttons);
    renderEditor(buttons);
    renderButtons(buttons);
  });

  document.getElementById("saveJsonBtn").addEventListener("click", ()=>{
    downloadButtonsJson(buttons);
    alert("butonlar.json indirildi. GitHub'daki butonlar.json dosyanƒ± bununla g√ºncelle.");
  });

  document.getElementById("importBtn").addEventListener("click", ()=>{
    const inp = document.createElement("input");
    inp.type = "file";
    inp.accept = "application/json";
    inp.onchange = e=>{
      const f = e.target.files[0];
      if(!f) return;
      const r = new FileReader();
      r.onload = ev=>{
        try{
          const parsed = JSON.parse(ev.target.result);
          if(Array.isArray(parsed)){
            buttons = parsed.map(b=>{
              if(!b.id) b.id = Date.now() + Math.floor(Math.random()*10000);
              if(!b.type) b.type = "link";
              return b;
            });
            saveButtonsLocally(buttons);
            renderEditor(buttons);
            renderButtons(buttons);
            alert("ƒ∞√ße aktarma ba≈üarƒ±lƒ±. ƒ∞stersen Kaydet (JSON indir) ile GitHub'a g√∂nderebilirsin.");
          }else{
            alert("Ge√ßersiz JSON formatƒ±.");
          }
        }catch(err){
          alert("JSON okunamadƒ±: " + err.message);
        }
      };
      r.readAsText(f);
    };
    inp.click();
  });

  document.getElementById("resetBtn").addEventListener("click", ()=>{
    if(!confirm("Yerel kaydƒ± sƒ±fƒ±rlamak istiyor musun? (GitHub'daki JSON silinmez)")) return;
    localStorage.removeItem(LOCAL_KEY);
    localStorage.removeItem(LOCAL_KEY+"_files");
    fileData = {};
    buttons = DEFAULTS.slice();
    saveButtonsLocally(buttons);
    renderEditor(buttons);
    renderButtons(buttons);
  });
});
</script>
</body>
</html>
